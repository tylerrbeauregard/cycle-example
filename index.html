<html>

<head>
    <title>Some Algebra Simulations</title>
</head>

<body style="table {border: none}">
    <h1>Generators of <i>S<sub>n</sub></i></h1>
    <p>Problem (9) of Homework 4 asks us to prove that <i>S<sub>n</sub></i>,
        the symmetric group on <i>n</i> letters, can be generated by (12) and (12...<i>n</i>). This interactive
        webpage can help one to test this out.</p>
    <canvas id="canvas" width="700" height="500"></canvas>
    <br />
    <span>
        <button onclick="permute_big();">Rotate big circle clockwise</button>
        <button onclick="permute_small();">Rotate half circle (1 &LeftRightArrow; 2)</button>
    </span>
    <br />
    <span>
        Number of elements:
        <button onclick="increment_elements()">+</button>
        <button onclick="decrement_elements()">-</button>
    </span></br>
    <span>Current permutation as generators:</span>
    <div style="width:80%; margin:auto">&sigma; = </span><span id="info"></span></div>
    <span>Current permutation:</span>
    <div style="width:50%; margin:auto">
        &sigma; = <span style="font-size: 40px;vertical-align: middle">(</span>
        <table style="display:inline-table;vertical-align: middle;" id="permutation"></table>
        <span style="font-size: 40px;vertical-align: middle">)</span>
    </div>


    <script>
        var number_of_points = 10;
        var permutation = Array(number_of_points);
        for (var i = 0; i < number_of_points; i++) {
            permutation[i] = i;
        }

        function init() {
            window.requestAnimationFrame(draw);
            create_table();
        }

        function create_table() {
            var table = document.getElementById("permutation");
            table.innerHTML = "";
            var row1 = document.createElement("tr");
            var row2 = document.createElement("tr");
            for (var i = 0; i < number_of_points; i++) {
                var item1 = document.createElement("td");
                item1.innerHTML = (i + 1).toString();
                row1.appendChild(item1);
                var item2 = document.createElement("td");
                item2.innerHTML = (permutation[i] + 1).toString();
                row2.appendChild(item2);
            }
            table.appendChild(row1);
            table.appendChild(row2);
        }

        function draw_number_with_circle(ctx, number, x, y, color) {
            ctx.beginPath();
            ctx.save()
            ctx.fillStyle = color;
            ctx.arc(x, y, 20, 0, 2 * Math.PI, false);
            ctx.stroke();
            ctx.fill();

            ctx.font = "32px serif";
            ctx.fillStyle = "black";
            ctx.fillText(number.toString(), x, y + 10);
            ctx.restore();
        }

        function draw_regular_poly_dots(ctx, points, radius, center_x, center_y) {
            var x = center_x;
            var y = center_y;
            var small_radius = 0.7 * radius;
            var angle = 2 * Math.PI / points;

            // Drawing the small half circle between 1 and 2
            ctx.save();
            ctx.strokeStyle = "black";
            ctx.beginPath();
            var x_1 = x + radius * Math.cos(angle * (points));
            var y_1 = y + radius * Math.sin(angle * (points));
            var x_2 = x + radius * Math.cos(angle * (points - 1));
            var y_2 = y + radius * Math.sin(angle * (points - 1));
            var x_circ = (x_1 + x_2) / 2;
            var y_circ = (y_1 + y_2) / 2;
            var circ_radius = Math.sqrt(
                (x_2 - x_1) ** 2 + (y_2 - y_1) ** 2) / 2;
            ctx.arc(x_circ, y_circ, circ_radius, 0, Math.PI * 2, false);
            ctx.stroke();
            ctx.restore();

            ctx.beginPath();
            ctx.fillStyle = "white";
            ctx.arc(x, y, radius, 0, Math.PI * 2, false);
            ctx.stroke();
            // This covers the half-circle.
            ctx.fill();

            for (var i = 0; i < points; i++) {
                ctx.beginPath();
                var to_x = x + radius * Math.cos(angle * (points - i));
                var to_y = y + radius * Math.sin(angle * (points - i));
                var inner_x = x + 0.7 * radius * Math.cos(angle * (points - i));
                var inner_y = y + 0.7 * radius * Math.sin(angle * (points - i));
                ctx.moveTo(to_x, to_y);
                ctx.lineTo(inner_x, inner_y);
                ctx.stroke();
                // Draw the red number on the outside
                draw_number_with_circle(ctx, permutation[i] + 1, to_x, to_y, "red");
                // Draw the silver number on the inside
                draw_number_with_circle(ctx, i + 1, inner_x, inner_y, "silver");
            }
        }

        function draw_legend(ctx, x, y) {
            ctx.save();
            ctx.strokeStyle = "black";
            ctx.beginPath();
            // Box
            ctx.rect(x, y, 130, 30 * 3 + 20);

            // Line
            ctx.moveTo(x, y + 40);
            ctx.lineTo(x + 130, y + 40);
            ctx.stroke();

            ctx.beginPath();
            ctx.font = "30px serif";
            ctx.fillStyle = "black";
            ctx.textAlign = "left";
            ctx.fillText("Legend:", x + 3, y + 30)
            ctx.textAlign = "right";
            ctx.font = "italic 30px serif";
            ctx.fillText("i:", x + 70, y + 5 + 30 * 2);
            //\u03C3 is just lowercase sigma
            ctx.fillText("\u03C3(i):", x + 70, y + 5 + 30 * 3);

            ctx.beginPath();
            ctx.fillStyle = "silver";
            ctx.arc(x + 90, y + 30 * 2, 10, 0, 2 * Math.PI, false);
            ctx.stroke();
            ctx.fill();
            ctx.beginPath();
            ctx.fillStyle = "red";
            ctx.arc(x + 90, y + 30 * 3, 10, 0, 2 * Math.PI, false);
            ctx.stroke();
            ctx.fill();
            ctx.restore();
        }

        function draw_small_button(ctx, points, radius, center_x, center_y) {
            var x = center_x;
            var y = center_y;
            var small_radius = 0.7 * radius;
            var angle = 2 * Math.PI / points;

            var interior_angle = (points - 2) * Math.PI / (2 * points);
            var buffer_angle = Math.PI / 6;

            ctx.save();
            ctx.strokeStyle = "black";
            ctx.lineWidth = 10;
            ctx.beginPath();
            var x_1 = x + radius * Math.cos(angle * (points));
            var y_1 = y + radius * Math.sin(angle * (points));
            var x_2 = x + radius * Math.cos(angle * (points - 1));
            var y_2 = y + radius * Math.sin(angle * (points - 1));
            var x_circ = (x_1 + x_2) / 2;
            var y_circ = (y_1 + y_2) / 2;
            var circ_radius = 30 + Math.sqrt(
                (x_2 - x_1) ** 2 + (y_2 - y_1) ** 2) / 2;
            ctx.arc(x_circ,
                y_circ,
                circ_radius,
                interior_angle - Math.PI + buffer_angle,
                interior_angle - buffer_angle,
                false);

            var top_x = x_circ + (circ_radius + 5) * Math.cos(interior_angle - Math.PI + buffer_angle);
            var top_y = y_circ + (circ_radius + 5) * Math.sin(interior_angle - Math.PI + buffer_angle);

            ctx.moveTo(top_x - 5, top_y);
            ctx.lineTo(top_x + 30, top_y);

            ctx.moveTo(top_x, top_y);
            ctx.lineTo(top_x, top_y + 30);

            var bottom_x = x_circ + (circ_radius + 5) * Math.cos(interior_angle - buffer_angle);
            var bottom_y = y_circ + (circ_radius + 5) * Math.sin(interior_angle - buffer_angle);

            ctx.moveTo(bottom_x - 5, bottom_y - 5);
            ctx.lineTo(bottom_x + 30 - 5, bottom_y - 5);

            ctx.moveTo(bottom_x - 5, bottom_y);
            ctx.lineTo(bottom_x - 5, bottom_y - 30);

            ctx.stroke();
            ctx.restore();
        }

        function test_big_arrow(mouse_x, mouse_y) {
            var points = number_of_points;
            var x = 300;
            var y = 250;
            var radius = 200;
            var angle = 2 * Math.PI / points;
            var circ_radius = 50 + radius;
            var arrow_start_angle = 2 * Math.PI * 6.3 / 12;
            var arrow_end_angle = 2 * Math.PI * 7.3 / 12;
            var radius_end_point_x = x + Math.cos(arrow_end_angle) * circ_radius;
            var radius_end_point_y = y + Math.sin(arrow_end_angle) * circ_radius;

            // Check if mouse is over big button
            var right_x = radius_end_point_x + 10;
            var left_x = x + Math.cos(arrow_start_angle) * circ_radius - 10;
            var top_y = radius_end_point_y - 10;
            var bottom_y = y + Math.sin(arrow_start_angle) * circ_radius + 10;

            return (mouse_x <= right_x
                && mouse_x >= left_x
                && mouse_y >= top_y
                && mouse_y <= bottom_y);
        }

        function test_small_arrow(mouse_x, mouse_y) {
            var points = number_of_points;
            var x = 300;
            var y = 250;
            var radius = 200;
            var angle = 2 * Math.PI / points;

            var interior_angle = (points - 2) * Math.PI / (2 * points);
            var buffer_angle = Math.PI / 6;

            var x_1 = x + radius * Math.cos(angle * (points));
            var y_1 = y + radius * Math.sin(angle * (points));
            var x_2 = x + radius * Math.cos(angle * (points - 1));
            var y_2 = y + radius * Math.sin(angle * (points - 1));
            var x_circ = (x_1 + x_2) / 2;
            var y_circ = (y_1 + y_2) / 2;
            var circ_radius = 30 + Math.sqrt(
                (x_2 - x_1) ** 2 + (y_2 - y_1) ** 2) / 2;

            var top_x = x_circ + (circ_radius + 5) * Math.cos(interior_angle - Math.PI + buffer_angle)-5;
            var top_y = y_circ + (circ_radius + 5) * Math.sin(interior_angle - Math.PI + buffer_angle)-5;

            var bottom_x = x_circ + (circ_radius + 5) * Math.cos(interior_angle - buffer_angle)+40;
            var bottom_y = y_circ + (circ_radius + 5) * Math.sin(interior_angle - buffer_angle)+40;

            return (mouse_x <= bottom_x
                && mouse_x >= top_x
                && mouse_y >= top_y
                && mouse_y <= bottom_y);
        }

        function mouse_move(canvas, event) {
            let rect = canvas.getBoundingClientRect();
            let mouse_x = event.clientX - rect.left;
            let mouse_y = event.clientY - rect.top;
            var points = number_of_points;

            if (test_big_arrow(mouse_x, mouse_y) || test_small_arrow(mouse_x,mouse_y)) {
                canvas.style.cursor = "pointer";
            } else {
                canvas.style.cursor = "default";
            }
        }

        function mouse_click(canvas, event) {
            let rect = canvas.getBoundingClientRect();
            let mouse_x = event.clientX - rect.left;
            let mouse_y = event.clientY - rect.top;
            var points = number_of_points;

            if (test_big_arrow(mouse_x, mouse_y)) {
              permute_big();  
            } else if (test_small_arrow(mouse_x, mouse_y)) {
              permute_small();
            }
        }

        document.getElementById("canvas").addEventListener("mousemove", function (e) {
            mouse_move(document.getElementById("canvas"), e);
        });

        document.getElementById("canvas").addEventListener("mouseup", function (e) {
            mouse_click(document.getElementById("canvas"), e);
        });

        function draw_big_button(ctx, points, radius, center_x, center_y) {
            ctx.save();
            var x = center_x;
            var y = center_y;
            var small_radius = 0.7 * radius;
            var angle = 2 * Math.PI / points;

            // Drawing the small half circle between 1 and 2
            ctx.strokeStyle = "black";
            // Maybe make thick
            ctx.lineWidth = 10;
            ctx.beginPath();
            // Add cosnst to radius
            var circ_radius = 50 + radius;
            var arrow_start_angle = 2 * Math.PI * 6.3 / 12;
            var arrow_end_angle = 2 * Math.PI * 7.3 / 12;

            ctx.arc(x, y,
                circ_radius,
                arrow_start_angle,
                arrow_end_angle, false);
            ctx.stroke();

            // Arrows at 45 deg angle from radius
            var radius_end_point_x = x + Math.cos(arrow_end_angle) * circ_radius;
            var radius_end_point_y = y + Math.sin(arrow_end_angle) * circ_radius;

            var arrow_size = 30;

            var left_arrow_end_x = radius_end_point_x - arrow_size;
            var left_arrow_end_y = radius_end_point_y;

            var right_arrow_end_x = radius_end_point_x;
            var right_arrow_end_y = radius_end_point_y + arrow_size;

            ctx.moveTo(radius_end_point_x + 5, radius_end_point_y);
            ctx.lineTo(left_arrow_end_x, left_arrow_end_y);
            ctx.moveTo(radius_end_point_x, radius_end_point_y);
            ctx.lineTo(right_arrow_end_x, right_arrow_end_y);
            ctx.stroke();

            ctx.restore();
        }

        // Simulates multiplication by (12...n) by making a new permutation
        // whose values are the old ones shifted +1 (and looped around)
        function permute_big() {
            // Temporary array to store old values while updating
            var old_permutation = Array(number_of_points);
            for (var i = 0; i < number_of_points; i++) {
                old_permutation[i] = permutation[i];
            }
            // Updating the permutation
            for (var i = 0; i < number_of_points; i++) {
                permutation[i] = (old_permutation[(i + 1) % number_of_points]);
            }
            // Prepending a (12...n)
            document.getElementById("info").innerHTML = "(12...<i>n</i>)" + document.getElementById("info").innerHTML;
            // Updating the permutation
            create_table();
        }

        // Swaps the first two values of the permutation
        function permute_small() {
            var temp = permutation[0];
            permutation[0] = permutation[1];
            permutation[1] = temp;
            // Prepending a (12)
            document.getElementById("info").innerHTML = "(12)" + document.getElementById("info").innerHTML;
            // Updating the permutation
            create_table();
        }

        function increment_elements() {
            number_of_points += 1;
            permutation = Array(number_of_points);
            for (var i = 0; i < number_of_points; i++) {
                permutation[i] = i;
            }
            create_table();
            document.getElementById("info").innerHTML = "";
        }

        function decrement_elements() {
            number_of_points -= 1;
            if (number_of_points < 1) {
                number_of_points = 1;
            }
            permutation = Array(number_of_points);
            for (var i = 0; i < number_of_points; i++) {
                permutation[i] = i;
            }
            create_table();
            document.getElementById("info").innerHTML = "";
        }

        function draw() {
            const ctx = document.getElementById("canvas").getContext("2d");
            ctx.textAlign = "center";


            ctx.clearRect(0, 0, 1000, 1000); // clear canvas
            ctx.fillStyle = "white";

            ctx.save();
            ctx.translate(150, 150);

            ctx.restore();

            draw_regular_poly_dots(ctx, number_of_points, 200, 300, 250);
            draw_big_button(ctx, number_of_points, 200, 300, 250);
            draw_small_button(ctx, number_of_points, 200, 300, 250);
            draw_legend(ctx, 520, 300);

            window.requestAnimationFrame(draw);
        }

        init();
    </script>

</body>

</html>
